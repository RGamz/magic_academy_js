<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="L'Acad√©mie des Mots Magiques - Apprends le fran√ßais de mani√®re ludique et interactive">
  <title>L'Acad√©mie des Mots Magiques - Accueil</title>
  
  <!-- Modern CSS -->
  <link rel="stylesheet" href="./css/styles-modern.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/assets/images/favicon.png">
  
  <!-- Preconnect to Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>

  <!-- Modern Header -->
  <header class="site-header" id="header">
    <div class="header-container">
      <a href="/" class="brand">
        <span class="brand-icon">‚ú®</span>
        <span class="brand-text">L'Acad√©mie des Mots Magiques</span>
      </a>
      
      <nav class="site-nav" aria-label="Navigation principale">
        <a href="./index.html" class="nav-link" aria-current="page">
          <span>üìö</span> Le√ßons
        </a>
        <a href="./games.html" class="nav-link">
          <span>üéÆ</span> Jeux
        </a>
        <a href="./vocabulary-practice.html" class="nav-link">
          <span>üó£Ô∏è</span> Vocabulaire
        </a>
        <a href="./speech_tests.html" class="nav-link">
          <span>üî¨</span> Tests
        </a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main id="main" class="container">
    <!-- Hero Section -->
    <section class="hero">
      <h1 class="hero-title">Bienvenue √† l'Acad√©mie des Mots Magiques</h1>
      <p class="hero-subtitle">D√©couvre la magie du fran√ßais avec des le√ßons interactives et des jeux amusants!</p>
    </section>

    <!-- Lessons Grid -->
    <section aria-labelledby="lessons-title">
      <h2 id="lessons-title" class="sr-only">Nos Le√ßons</h2>
      <div id="lessons-grid" class="card-grid" role="list">
        <!-- Loading skeletons will be shown initially -->
        <div class="skeleton-card">
          <div class="skeleton-media"></div>
          <div class="skeleton-content">
            <div class="skeleton-line"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
        <div class="skeleton-card">
          <div class="skeleton-media"></div>
          <div class="skeleton-content">
            <div class="skeleton-line"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
        <div class="skeleton-card">
          <div class="skeleton-media"></div>
          <div class="skeleton-content">
            <div class="skeleton-line"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modern JavaScript -->
  <script>
    // Header scroll effect
    let lastScroll = 0;
    const header = document.getElementById('header');
    
    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset;
      
      if (currentScroll > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
      
      lastScroll = currentScroll;
    });

    // Fetch and display lessons
    const lessonsGrid = document.getElementById('lessons-grid');
    
    // Helper function to get difficulty badge emoji
    function getDifficultyEmoji(tag) {
      const emojiMap = {
        'D√©butant': 'üå±',
        'Interm√©diaire': 'üåø',
        'Avanc√©': 'üå≥',
        'Expert': 'üèÜ',
        'Nouveau': '‚ú®'
      };
      return emojiMap[tag] || 'üìö';
    }
    
    // Helper function to get difficulty color
    function getDifficultyColor(tag) {
      const colorMap = {
        'D√©butant': '#10b981',
        'Interm√©diaire': '#3b82f6',
        'Avanc√©': '#8b5cf6',
        'Expert': '#f59e0b',
        'Nouveau': '#ec4899'
      };
      return colorMap[tag] || '#6b7280';
    }
    
    // Render lesson cards
    function renderLessons(lessons) {
      lessonsGrid.innerHTML = lessons.map((lesson, index) => `
        <article class="lesson-card" role="listitem" style="animation-delay: ${index * 0.1}s">
          <a href="./lesson.html?id=${encodeURIComponent(lesson.slug)}" class="card-link">
            <div class="card-media">
              <img 
                src="${lesson.cover || '/assets/images/default-lesson.jpg'}" 
                alt="${lesson.title}" 
                class="card-image"
                loading="lazy"
              >
              ${lesson.tag ? `
                <div class="card-badge" style="color: ${getDifficultyColor(lesson.tag)}">
                  <span class="badge-icon">${getDifficultyEmoji(lesson.tag)}</span>
                  <span>${lesson.tag}</span>
                </div>
              ` : ''}
            </div>
            
            <div class="card-content">
              <h3 class="card-title">${lesson.title}</h3>
              <p class="card-description">${lesson.description || 'D√©couvre cette le√ßon magique!'}</p>
            </div>
            
            <div class="card-footer">
              <div class="card-meta">
                <span class="meta-item">
                  <span>üìù</span>
                  <span>${lesson.task_count || 0} t√¢ches</span>
                </span>
                ${lesson.duration ? `
                  <span class="meta-item">
                    <span>‚è±Ô∏è</span>
                    <span>${lesson.duration}</span>
                  </span>
                ` : ''}
              </div>
              <button class="card-action" aria-label="Commencer la le√ßon">
                Commencer
                <span class="btn-icon">‚Üí</span>
              </button>
            </div>
          </a>
        </article>
      `).join('');
    }
    
    // Fetch lessons from API
    async function loadLessons() {
      try {
        const response = await fetch('/api/lessons', { cache: 'no-store' });
        const data = await response.json();
        
        if (data.success && data.data) {
          renderLessons(data.data);
        } else {
          throw new Error('Invalid API response');
        }
      } catch (error) {
        console.error('Error loading lessons:', error);
        lessonsGrid.innerHTML = `
          <div class="error-message">
            <p>üòï Oups! Impossible de charger les le√ßons.</p>
            <button class="btn btn-primary" onclick="location.reload()">
              R√©essayer
            </button>
          </div>
        `;
      }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadLessons();
    });
    
    // Add some fun interactions
    document.addEventListener('mousemove', (e) => {
      const cards = document.querySelectorAll('.lesson-card');
      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        const deltaX = (x - centerX) / centerX;
        const deltaY = (y - centerY) / centerY;
        
        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        
        if (distance < 1) {
          card.style.setProperty('--mouse-x', `${deltaX * 10}px`);
          card.style.setProperty('--mouse-y', `${deltaY * 10}px`);
        }
      });
    });
  </script>

  <!-- Add inline styles for mouse tracking effect -->
  <style>
    .lesson-card {
      --mouse-x: 0px;
      --mouse-y: 0px;
    }
    
    .lesson-card:hover {
      transform: translateY(-8px) 
                 translateX(var(--mouse-x)) 
                 translateY(var(--mouse-y)) 
                 scale(1.02);
    }
    
    /* Error message styling */
    .error-message {
      text-align: center;
      padding: var(--spacing-xl);
      color: white;
    }
    
    .error-message p {
      font-size: 1.25rem;
      margin-bottom: var(--spacing-md);
    }
  </style>
</body>
</html>