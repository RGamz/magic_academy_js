<!DOCTYPE html>
<html lang="fr">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="L'Acad√©mie des Mots Magiques - Le√ßon Interactive">
    <title>Le√ßon - L'Acad√©mie des Mots Magiques</title>
    
    <!-- Modern CSS -->
    <link rel="stylesheet" href="./css/styles-modern.css">
    <link rel="stylesheet" href="./css/lesson-styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    </head>

    <body>

    <!-- Modern Header -->
    <header class="site-header" id="header">
        <div class="header-container">
        <a href="/" class="brand">
            <span class="brand-icon">‚ú®</span>
            <span class="brand-text">L'Acad√©mie des Mots Magiques</span>
        </a>
        
        <nav class="site-nav" aria-label="Navigation principale">
            <a href="./index.html" class="nav-link" aria-current="page">
                <span>üìö</span> Le√ßons
            </a>
            <a href="./games.html" class="nav-link">
                <span>üéÆ</spa> Jeux
            </a>
            <a href="./speech_tests.html" class="nav-link">
                <span>üî¨</span> Tests
            </a>
            <a href="#progress" class="nav-link">
                <span>üìä</span> Progr√®s
            </a>
        </nav>
        </div>
    </header>

      <!-- Main Content -->
    <main id="main" class="container">
    <!-- Hero Section -->
        <section class="hero">
            <h1 class="hero-title">Bienvenue √† la laboratoire!üî¨</h1>
            <p class="hero-subtitle">C'est l'heure de se tester!</p>
        </section>

        <section class="test-section">
            <button id="start" class="card-action">üéôÔ∏è Parle!</button>
            <p id="result" class="recongnized-result"></p>
            <p id="feedback" class="recognized-feedback"></p>
        </section>
        
    </main>

    <script>
        const expected = "j'ai un fr√®re et une s≈ìur";

        const startBtn = document.getElementById("start");
        const resultEl = document.getElementById("result");
        const feedbackEl = document.getElementById("feedback");

        let recognition;

        if ("webkitSpeechRecognition" in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = "fr-FR"; // —è–∑—ã–∫ —É—Ä–æ–∫–∞
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
        } else {
            alert("Speech recognition is not supported in this browser.");
        }

        startBtn.onclick = () => {
            recognition.start();
            resultEl.textContent = "J'√©coute...";
        };

        recognition.onresult = (event) => {
            const userText = event.results[0][0].transcript.toLowerCase();
            resultEl.textContent = userText;
            const fb = comparePhrases(userText, expected);
            feedbackEl.innerHTML = fb;
        };

        function removeAccents(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function comparePhrases(user, expected) {
        const u = removeAccents(user).split(/\s+/);
        const e = removeAccents(expected).split(/\s+/);

        let missing = [];
        let extra = [];

        e.forEach(word => {
            if (!u.includes(word)) missing.push(word);
        });

        u.forEach(word => {
            if (!e.includes(word)) extra.push(word);
        });

        let html = "";

        if (missing.length === 0 && extra.length === 0) {
            html += "<p style='color:green'>‚úî –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –°–º—ã—Å–ª –ø–µ—Ä–µ–¥–∞–Ω –≤–µ—Ä–Ω–æ.</p>";
        } else {
            html += "<p style='color:orange'>‚ö† –§—Ä–∞–∑–∞ –ø–æ–Ω—è—Ç–∞, –Ω–æ –µ—Å—Ç—å –æ—à–∏–±–∫–∏.</p>";
            if (missing.length > 0)
            html += "<p>–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å–ª–æ–≤: <b>" + missing.join(", ") + "</b></p>";
            if (extra.length > 0)
            html += "<p>–õ–∏—à–Ω–∏–µ —Å–ª–æ–≤–∞: <b>" + extra.join(", ") + "</b></p>";
        }

        html += "<p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: <i>" + expected + "</i></p>";

        return html;
        }
    </script>

    <style>
        .test-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .recongnized-result {
            color: purple;
            background-color: beige;
            border-color: purple;
            border: 2px;
            border-style: solid;
            border-radius: 10px;
            min-height: 40px;
            min-width: 200px;
            padding: 10px 40px 10px 40px;
        }

        .recognized-feedback {
            background-color: beige;
            border: 2px;
            border-style: solid;
            border-radius: 10px;
            min-height: 40px;
            min-width: 200px;
            padding: 10px 40px 10px 40px;
        }
    </style>

    </body>
</html>